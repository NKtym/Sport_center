pg_stat_database_basic:
  query: |
    SELECT
      datname,
      numbackends,
      xact_commit,
      xact_rollback,
      blks_read,
      blks_hit,
      tup_returned,
      tup_fetched,
      tup_inserted,
      tup_updated,
      tup_deleted,
      deadlocks
    FROM pg_stat_database;
  metrics:
    - datname: { usage: "LABEL" }
    - numbackends: { usage: "GAUGE" }
    - xact_commit: { usage: "COUNTER" }
    - xact_rollback: { usage: "COUNTER" }
    - blks_read: { usage: "COUNTER" }
    - blks_hit: { usage: "COUNTER" }
    - tup_returned: { usage: "COUNTER" }
    - tup_fetched: { usage: "COUNTER" }
    - tup_inserted: { usage: "COUNTER" }
    - tup_updated: { usage: "COUNTER" }
    - tup_deleted: { usage: "COUNTER" }
    - deadlocks: { usage: "COUNTER" }

pg_stat_activity_counts:
  query: |
    SELECT datname, state, count(*) as count
    FROM pg_stat_activity
    GROUP BY datname, state;
  metrics:
    - datname: { usage: "LABEL" }
    - state: { usage: "LABEL" }
    - count: { usage: "GAUGE" }

pg_locks_count:
  query: |
    SELECT d.datname, l.mode, count(*) as cnt
    FROM pg_locks l
    LEFT JOIN pg_database d ON l.database = d.oid
    GROUP BY d.datname, l.mode;
  metrics:
    - datname: { usage: "LABEL" }
    - mode: { usage: "LABEL" }
    - cnt: { usage: "GAUGE" }
